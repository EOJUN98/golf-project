# TUGOL í”„ë¡œì íŠ¸ ê°œë°œ ì™„ì „ ê¸°ë¡ (AI í•™ìŠµìš©)

**í”„ë¡œì íŠ¸ëª…:** TUGOL - ë™ì  ê°€ê²© ì±…ì • ê³¨í”„ ì˜ˆì•½ í”Œë«í¼
**ê¸°ìˆ  ìŠ¤íƒ:** Next.js 16 (App Router), TypeScript, Tailwind CSS, Supabase
**í˜„ì¬ ë²„ì „:** v0.9 (ì¸ì¦ + ê´€ë¦¬ì ì‹œìŠ¤í…œ ì™„ë£Œ)
**ë¬¸ì„œ ìƒì„±ì¼:** 2026-01-16
**ëª©ì :** AI ì»¨í…ìŠ¤íŠ¸ í•™ìŠµ ë° í”„ë¡œì íŠ¸ ì§€ì†ì„± ë³´ì¥

---

## ëª©ì°¨
1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#2-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
3. [í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§](#3-í•µì‹¬-ë¹„ì¦ˆë‹ˆìŠ¤-ë¡œì§)
4. [ì¸ì¦ ì‹œìŠ¤í…œ](#4-ì¸ì¦-ì‹œìŠ¤í…œ)
5. [ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ](#5-ê´€ë¦¬ì-ëŒ€ì‹œë³´ë“œ)
6. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸](#6-ì£¼ìš”-ì»´í¬ë„ŒíŠ¸)
7. [ê°œë°œ ë‹¨ê³„ë³„ íˆìŠ¤í† ë¦¬](#7-ê°œë°œ-ë‹¨ê³„ë³„-íˆìŠ¤í† ë¦¬)
8. [ì½”ë“œ ì»¨ë²¤ì…˜ ë° íŒ¨í„´](#8-ì½”ë“œ-ì»¨ë²¤ì…˜-ë°-íŒ¨í„´)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸
TUGOLì€ ê³¨í”„ì¥ í‹°íƒ€ì„(Tee Time)ì„ ì‹¤ì‹œê°„ ë™ì  ê°€ê²©ìœ¼ë¡œ íŒë§¤í•˜ëŠ” í”Œë«í¼ì…ë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•:

- **ë™ì  ê°€ê²© ì±…ì •**: ë‚ ì”¨, ì‹œê°„ëŒ€, ì‚¬ìš©ì ë“±ê¸‰, ìœ„ì¹˜ ë“±ì„ ê³ ë ¤í•œ ì‹¤ì‹œê°„ í• ì¸
- **íŒ¨ë‹‰ ëª¨ë“œ**: í‹°ì˜¤í”„ ì„ë°• ì‹œ ê¸´ê¸‰ í• ì¸ìœ¼ë¡œ ê³µì‹¤ ìµœì†Œí™”
- **ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸**: 4ë‹¨ê³„ ë“±ê¸‰(FUTURE, SMART, CHERRY, PRESTIGE)ìœ¼ë¡œ ì°¨ë³„í™”ëœ í˜œíƒ
- **ë‚ ì”¨ ì—°ë™**: ê°•ìˆ˜ëŸ‰ ì˜ˆë³´ì— ë”°ë¥¸ ì˜ˆì•½ ì°¨ë‹¨ ë° í• ì¸

### 1.2 ê¸°ìˆ  ì•„í‚¤í…ì²˜

```
Next.js 16 (App Router)
â”œâ”€â”€ Frontend (React Server Components + Client Components)
â”‚   â”œâ”€â”€ Server Components: ë°ì´í„° í˜ì¹­, SEO ìµœì í™”
â”‚   â””â”€â”€ Client Components: ì¸í„°ë™ì…˜, ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ Backend (Server Actions + API Routes)
â”‚   â”œâ”€â”€ Server Actions: ì¸ì¦, ì˜ˆì•½, ê²°ì œ ë¡œì§
â”‚   â””â”€â”€ API Routes: ì™¸ë¶€ API í”„ë¡ì‹œ (ë‚ ì”¨ ë“±)
â”œâ”€â”€ Database (Supabase - PostgreSQL)
â”‚   â”œâ”€â”€ Auth: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ + ì¹´ì¹´ì˜¤ OAuth
â”‚   â”œâ”€â”€ RLS (Row Level Security): ì‚¬ìš©ìë³„ ë°ì´í„° ì ‘ê·¼ ì œì–´
â”‚   â””â”€â”€ Triggers: auth.users â†’ public.users ìë™ ìƒì„±
â””â”€â”€ Pricing Engine (Deterministic Algorithm)
    â”œâ”€â”€ Seeded Random: í‹°íƒ€ì„ë³„ ê³ ì • ì‹œë“œë¡œ ê°€ê²© ì¼ê´€ì„± ë³´ì¥
    â”œâ”€â”€ Multi-factor Discounts: ë‚ ì”¨/ì‹œê°„/ë“±ê¸‰/ìœ„ì¹˜ ë³µí•© í• ì¸
    â””â”€â”€ Revenue Protection: ìµœëŒ€ 40% í• ì¸ ìƒí•œì„ 
```

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 2.1 users í…Œì´ë¸” (ì‚¬ìš©ì ì •ë³´)

```sql
CREATE TABLE public.users (
  -- ì‹ë³„ ì •ë³´
  id TEXT PRIMARY KEY,                    -- UUID from auth.users
  email TEXT NOT NULL UNIQUE,
  name TEXT,
  phone TEXT,

  -- ì‚¬ìš©ì ë“±ê¸‰ ì‹œìŠ¤í…œ
  segment TEXT NOT NULL DEFAULT 'FUTURE', -- 'FUTURE' | 'PRESTIGE' | 'SMART' | 'CHERRY'
  cherry_score INTEGER NOT NULL DEFAULT 0,
  segment_override_by TEXT,               -- ê´€ë¦¬ì ìˆ˜ë™ ë³€ê²½ ì‹œ ê¸°ë¡
  segment_override_at TIMESTAMPTZ,

  -- ê´€ë¦¬ì ê¶Œí•œ
  is_admin BOOLEAN NOT NULL DEFAULT FALSE,

  -- ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
  blacklisted BOOLEAN NOT NULL DEFAULT FALSE,
  blacklist_reason TEXT,
  blacklisted_at TIMESTAMPTZ,
  blacklisted_by TEXT,

  -- í–‰ë™ ì¶”ì 
  no_show_count INTEGER NOT NULL DEFAULT 0,
  last_no_show_at TIMESTAMPTZ,
  total_bookings INTEGER NOT NULL DEFAULT 0,
  total_spent NUMERIC(12,2) NOT NULL DEFAULT 0,
  avg_booking_value NUMERIC(10,2) NOT NULL DEFAULT 0,

  -- ìœ„ì¹˜ ì •ë³´ (LBS í• ì¸ìš©)
  location_lat NUMERIC(10,8),
  location_lng NUMERIC(11,8),
  location_address TEXT,
  distance_to_club_km NUMERIC(5,2),

  -- ë°©ë¬¸ ê¸°ë¡
  visit_count INTEGER NOT NULL DEFAULT 0,
  avg_stay_minutes INTEGER,
  last_visited_at TIMESTAMPTZ,

  -- ë§ˆì¼€íŒ… ë™ì˜
  marketing_agreed BOOLEAN NOT NULL DEFAULT FALSE,
  push_agreed BOOLEAN NOT NULL DEFAULT FALSE,
  terms_agreed_at TIMESTAMPTZ,

  -- ë©”íƒ€ë°ì´í„°
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_users_segment ON users(segment);
CREATE INDEX idx_users_is_admin ON users(is_admin) WHERE is_admin = TRUE;
CREATE INDEX idx_users_blacklisted ON users(blacklisted) WHERE blacklisted = TRUE;
```

**TypeScript íƒ€ì… ì •ì˜** (`types/database.ts`):
```typescript
export interface Database {
  public: {
    Tables: {
      users: {
        Row: {
          id: string
          email: string
          name: string | null
          phone: string | null
          segment: 'FUTURE' | 'PRESTIGE' | 'SMART' | 'CHERRY'
          cherry_score: number
          is_admin: boolean
          blacklisted: boolean
          blacklist_reason: string | null
          blacklisted_at: string | null
          blacklisted_by: string | null
          no_show_count: number
          last_no_show_at: string | null
          total_bookings: number
          total_spent: number
          avg_booking_value: number
          location_lat: number | null
          location_lng: number | null
          location_address: string | null
          distance_to_club_km: number | null
          visit_count: number
          avg_stay_minutes: number | null
          last_visited_at: string | null
          segment_override_by: string | null
          segment_override_at: string | null
          marketing_agreed: boolean
          push_agreed: boolean
          terms_agreed_at: string | null
          created_at: string
          updated_at: string | null
        }
        Insert: { /* ë™ì¼ êµ¬ì¡° + optional í•„ë“œ */ }
        Update: { /* ë™ì¼ êµ¬ì¡° + ëª¨ë‘ optional */ }
      }
    }
  }
}
```

### 2.2 tee_times í…Œì´ë¸” (í‹°íƒ€ì„ ìŠ¬ë¡¯)

```sql
CREATE TABLE public.tee_times (
  id SERIAL PRIMARY KEY,
  golf_club_id INTEGER NOT NULL DEFAULT 1,
  tee_off TIMESTAMPTZ NOT NULL,
  base_price NUMERIC(10,2) NOT NULL,
  status TEXT NOT NULL DEFAULT 'OPEN',  -- 'OPEN' | 'BOOKED' | 'BLOCKED'
  weather_condition JSONB,
  reserved_by TEXT REFERENCES auth.users(id),
  reserved_at TIMESTAMPTZ
);

CREATE INDEX idx_tee_times_tee_off ON tee_times(tee_off);
CREATE INDEX idx_tee_times_status ON tee_times(status);
```

**weather_condition JSONB êµ¬ì¡°**:
```json
{
  "sky": "ë§‘ìŒ",
  "temperature": 20,
  "rainProb": 10,
  "windSpeed": 2.5
}
```

### 2.3 reservations í…Œì´ë¸” (ì˜ˆì•½ ë‚´ì—­)

```sql
CREATE TABLE public.reservations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tee_time_id INTEGER NOT NULL REFERENCES tee_times(id),
  user_id TEXT NOT NULL REFERENCES auth.users(id),
  base_price NUMERIC(10,2) NOT NULL,
  final_price NUMERIC(10,2) NOT NULL,
  discount_breakdown JSONB,
  payment_key TEXT,
  payment_status TEXT NOT NULL DEFAULT 'PENDING',  -- 'PENDING' | 'PAID' | 'CANCELLED' | 'REFUNDED'
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_reservations_user_id ON reservations(user_id);
CREATE INDEX idx_reservations_tee_time_id ON reservations(tee_time_id);
```

**discount_breakdown JSONB êµ¬ì¡°**:
```json
{
  "factors": [
    {
      "code": "TIME_STEP",
      "description": "Time Deal (Step 2)",
      "amount": -10000,
      "rate": 0.1
    },
    {
      "code": "WEATHER",
      "description": "Rain Forecast (20%)",
      "amount": -18000,
      "rate": 0.2
    }
  ],
  "totalDiscount": 28000,
  "discountRate": 0.28
}
```

### 2.4 RLS (Row Level Security) ì •ì±…

```sql
-- ì‚¬ìš©ì: ë³¸ì¸ í”„ë¡œí•„ë§Œ ì¡°íšŒ/ìˆ˜ì •
CREATE POLICY "Users can view their own profile"
ON public.users FOR SELECT
USING (auth.uid()::text = id);

CREATE POLICY "Users can update their own profile"
ON public.users FOR UPDATE
USING (auth.uid()::text = id);

-- ê´€ë¦¬ì: ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ/ìˆ˜ì •
CREATE POLICY "Admins can view all users"
ON public.users FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM public.users
    WHERE id = auth.uid()::text AND is_admin = TRUE
  )
);

CREATE POLICY "Admins can update all users"
ON public.users FOR UPDATE
USING (
  EXISTS (
    SELECT 1 FROM public.users
    WHERE id = auth.uid()::text AND is_admin = TRUE
  )
);
```

### 2.5 ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ë¦¬ê±°

**ì‹ ê·œ ì‚¬ìš©ì ìë™ ìƒì„± íŠ¸ë¦¬ê±°**:
```sql
CREATE OR REPLACE FUNCTION handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.users (
    id,
    email,
    name,
    phone,
    segment,
    cherry_score
  )
  VALUES (
    NEW.id,
    NEW.email,
    NEW.raw_user_meta_data->>'name',
    NEW.raw_user_meta_data->>'phone',
    'FUTURE',  -- ì‹ ê·œ ê°€ì…ìëŠ” FUTURE ë“±ê¸‰ìœ¼ë¡œ ì‹œì‘
    0
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION handle_new_user();
```

---

## 3. í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

### 3.1 ê°€ê²© ì±…ì • ì—”ì§„ (`utils/pricingEngine.ts`)

#### 3.1.1 ê°€ê²© ê³„ì‚° íë¦„

```typescript
export function calculatePricing(ctx: PricingContext): PricingResult {
  // Step 0: ì´ˆê¸°í™”
  const basePrice = ctx.teeTime.base_price;
  let currentPrice = basePrice;

  // Step 1: ì•ˆì „ ì°¨ë‹¨ (ë‚ ì”¨)
  if (weather.rainfall >= 10mm) {
    return { isBlocked: true, blockReason: 'WEATHER_STORM' };
  }

  // Step 2: ê³ ì • ê¸ˆì•¡ í• ì¸ (ì‹œê°„ëŒ€ í• ì¸)
  currentPrice -= calculateStepDiscount(timeUntilTeeOff);

  // Step 3: í¼ì„¼íŠ¸ í• ì¸ (ë³µí•© ì ìš©)
  currentPrice *= (1 - weatherDiscount);
  currentPrice *= (1 - segmentDiscount);
  currentPrice *= (1 - lbsDiscount);

  // Step 4: ìƒí•œì„  ì ìš© (ìµœëŒ€ 40% í• ì¸)
  const minPrice = basePrice * 0.6;
  currentPrice = Math.max(currentPrice, minPrice);

  // Step 5: íŒ¨ë‹‰ ëª¨ë“œ í”Œë˜ê·¸
  if (timeUntilTeeOff < 30 && isPanicCandidate) {
    panicMode.active = true;
  }

  return { finalPrice: currentPrice, factors, panicMode };
}
```

#### 3.1.2 ê²°ì •ë¡ ì  ëœë¤ (Seeded Random)

**í•µì‹¬ ì›ë¦¬**: í‹°íƒ€ì„ IDë¥¼ ì‹œë“œë¡œ ì‚¬ìš©í•˜ì—¬ í•­ìƒ ë™ì¼í•œ "ëœë¤" ê°’ ìƒì„±

```typescript
class SeededRandom {
  private seed: number;

  constructor(seed: number) {
    this.seed = seed;
  }

  next(): number {
    // Linear Congruential Generator (LCG)
    this.seed = (this.seed * 9301 + 49297) % 233280;
    return this.seed / 233280;
  }

  range(min: number, max: number): number {
    return min + Math.floor(this.next() * (max - min + 1));
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const rng = new SeededRandom(teeTime.id);  // teeTime.id = 123
const interval1 = rng.range(10, 30);       // í•­ìƒ ê°™ì€ ê°’ (ì˜ˆ: 17)
const interval2 = rng.range(10, 30);       // í•­ìƒ ê°™ì€ ê°’ (ì˜ˆ: 24)
```

**ì™œ ì¤‘ìš”í•œê°€?**
- ì‚¬ìš©ìê°€ ìƒˆë¡œê³ ì¹¨í•´ë„ ê°€ê²©ì´ ë³€í•˜ì§€ ì•ŠìŒ â†’ ì‹ ë¢°ì„±
- ì„œë²„ ì¬ì‹œì‘ í›„ì—ë„ ë™ì¼í•œ ê°€ê²© â†’ ì¼ê´€ì„±
- ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì¡°íšŒí•´ë„ ë™ì¼í•œ ê°€ê²© â†’ ê³µì •ì„±

#### 3.1.3 ì‹œê°„ëŒ€ í• ì¸ (Step-down Discount)

**ì •ì±…**:
- í‹°ì˜¤í”„ 2ì‹œê°„ ì „ë¶€í„° ì‹œì‘
- 3ë‹¨ê³„ë¡œ êµ¬ì„± (Step 1 â†’ Step 2 â†’ Step 3)
- ê° ë‹¨ê³„ëŠ” 10~30ë¶„ ëœë¤ ê°„ê²© (seeded random)
- ê¸°ë³¸ê°€ â‰¥ 10ë§Œì›: ë‹¨ê³„ë‹¹ 1ë§Œì› í• ì¸
- ê¸°ë³¸ê°€ < 10ë§Œì›: ë‹¨ê³„ë‹¹ 5ì²œì› í• ì¸

**ì‹¤ì œ ì½”ë“œ**:
```typescript
const timeUntilTeeOffMins = (teeOff.getTime() - now.getTime()) / (1000 * 60);
const rng = new SeededRandom(teeTime.id);

// ë‹¨ê³„ë³„ ì‹œì‘ ì‹œê°„ ê³„ì‚° (ë¶„ ë‹¨ìœ„)
const step1Start = 120;  // í‹°ì˜¤í”„ 2ì‹œê°„ ì „
const step1Duration = rng.range(10, 30);
const step2Start = step1Start - step1Duration;
const step2Duration = rng.range(10, 30);
const step3Start = step2Start - step2Duration;

// í˜„ì¬ ì–´ëŠ ë‹¨ê³„ì¸ì§€ íŒë‹¨
let stepLevel = 0;
if (timeUntilTeeOffMins <= step1Start) {
  if (timeUntilTeeOffMins > step2Start) stepLevel = 1;
  else if (timeUntilTeeOffMins > step3Start) stepLevel = 2;
  else stepLevel = 3;
}

// í• ì¸ ê¸ˆì•¡ ê³„ì‚°
const stepAmount = basePrice >= 100000 ? 10000 : 5000;
const totalStepDiscount = stepLevel * stepAmount;
currentPrice -= totalStepDiscount;
```

**ì˜ˆì‹œ**:
```
í‹°íƒ€ì„: ì˜¤í›„ 2:00 (14:00)
í˜„ì¬ ì‹œê°: 12:35

â†’ timeUntilTeeOff = 85ë¶„
â†’ step1Start = 120ë¶„ ì „ (12:00)
â†’ step2Start = 107ë¶„ ì „ (12:13, step1 duration = 13ë¶„)
â†’ step3Start = 89ë¶„ ì „ (12:31, step2 duration = 18ë¶„)

í˜„ì¬ 85ë¶„ ë‚¨ìŒ â†’ Step 3 ì§„ì…!
ê¸°ë³¸ê°€: 120,000ì›
í• ì¸: 3 Ã— 10,000ì› = 30,000ì›
â†’ í˜„ì¬ê°€: 90,000ì›
```

#### 3.1.4 ë‚ ì”¨ í• ì¸

```typescript
let weatherRate = 0;
if (weather.rn1 >= 1 || weather.pop >= 60) {
  weatherRate = 0.20;  // ë¹„ ì˜ˆë³´ 20% í• ì¸
} else if (weather.pop >= 30) {
  weatherRate = 0.10;  // íë¦¼ 10% í• ì¸
}

const discountAmount = Math.floor(currentPrice * weatherRate);
currentPrice -= discountAmount;
```

**ë‚ ì”¨ API í†µí•©** (`app/api/pricing/route.ts`):
```typescript
// ê¸°ìƒì²­ API: ë‹¨ê¸° ì˜ˆë³´ ì¡°íšŒ
const response = await fetch(
  `http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${WEATHER_API_KEY}&base_date=${baseDate}&base_time=${baseTime}&nx=54&ny=123`
);

// ì‘ë‹µ íŒŒì‹±
const rainProb = items.find(item => item.category === 'POP')?.fcstValue || 0;
const rainfall = items.find(item => item.category === 'RN1')?.fcstValue || 0;
```

#### 3.1.5 ì‚¬ìš©ì ë“±ê¸‰ í• ì¸

```typescript
if (user && user.segment === 'PRESTIGE') {
  const rate = 0.05;  // PRESTIGE íšŒì› 5% í• ì¸
  const discountAmount = Math.floor(currentPrice * rate);
  currentPrice -= discountAmount;
}
```

**ë“±ê¸‰ë³„ í˜œíƒ** (í˜„ì¬ êµ¬í˜„):
- **FUTURE** (ì‹ ê·œ): í• ì¸ ì—†ìŒ
- **SMART** (ì¼ë°˜): í• ì¸ ì—†ìŒ
- **CHERRY** (ìš°ìˆ˜): í• ì¸ ì—†ìŒ (í–¥í›„ í™•ì¥)
- **PRESTIGE** (VIP): 5% ì¶”ê°€ í• ì¸

#### 3.1.6 ìœ„ì¹˜ ê¸°ë°˜ í• ì¸ (LBS)

```typescript
if (userDistanceKm !== undefined && userDistanceKm <= 15) {
  const rate = 0.10;  // 15km ì´ë‚´ ì§€ì—­ ì£¼ë¯¼ 10% í• ì¸
  const discountAmount = Math.floor(currentPrice * rate);
  currentPrice -= discountAmount;
}
```

#### 3.1.7 ìˆ˜ìµ ë³´í˜¸ ì •ì±… (40% ìƒí•œì„ )

```typescript
// ìµœëŒ€ 40% í• ì¸ê¹Œì§€ë§Œ í—ˆìš©
const maxDiscountAmount = Math.floor(basePrice * 0.40);
const minPrice = basePrice - maxDiscountAmount;

if (currentPrice < minPrice) {
  currentPrice = minPrice;
  factors.push({
    code: 'MAX_CAP',
    description: 'Max Discount Cap (40%)',
    amount: minPrice - currentPrice,
    rate: 0.40
  });
}
```

**ì™œ í•„ìš”í•œê°€?**
- ê³¼ë„í•œ í• ì¸ìœ¼ë¡œ ì¸í•œ ìˆ˜ìµ ì†ì‹¤ ë°©ì§€
- ê³¨í”„ì¥ íŒŒíŠ¸ë„ˆì‚¬ì™€ì˜ ì•½ì • ì¤€ìˆ˜
- ê°€ê²© ì‹ ë¢°ë„ ìœ ì§€ (ë„ˆë¬´ ì‹¼ ê°€ê²©ì€ ì˜ì‹¬ ìœ ë°œ)

#### 3.1.8 íŒ¨ë‹‰ ëª¨ë“œ

**ì¡°ê±´**:
1. í‹°ì˜¤í”„ 30ë¶„ ì „
2. ì•„ì§ ì˜ˆì•½ë˜ì§€ ì•ŠìŒ (status = 'OPEN')
3. 20% í™•ë¥ ë¡œ í™œì„±í™” (seeded random)

```typescript
let panicMode = { active: false, minutesLeft: 0, reason: '' };

if (timeUntilTeeOffMins <= 30 && timeUntilTeeOffMins > 0) {
  const panicSeed = new SeededRandom(teeTime.id + 999);
  const shouldPanic = panicSeed.next() > 0.8;  // 20% í™•ë¥ 

  if (shouldPanic) {
    panicMode = {
      active: true,
      minutesLeft: Math.floor(timeUntilTeeOffMins),
      reason: timeUntilTeeOffMins <= 10
        ? 'ê¸´ê¸‰! ê³§ ë§ˆê°ë©ë‹ˆë‹¤'
        : 'ê³µì‹¤ ì„ë°•! ì§€ê¸ˆ ì˜ˆì•½í•˜ì„¸ìš”'
    };
  }
}
```

**UI íš¨ê³¼** (`components/TeeTimeList.tsx`):
```typescript
{panicMode.active && (
  <div className="fixed inset-0 bg-black/50 z-40 flex items-center justify-center">
    <div className="bg-gradient-to-br from-red-500 to-orange-500 text-white p-8 rounded-2xl shadow-2xl">
      <div className="text-4xl font-black mb-2">âš¡ PANIC MODE</div>
      <div className="text-xl">{panicMode.reason}</div>
      <div className="text-6xl font-black mt-4">{panicMode.minutesLeft}ë¶„</div>
    </div>
  </div>
)}
```

### 3.2 ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸ ìë™ ì¡°íšŒ (`utils/supabase/queries.ts`)

**í•µì‹¬ ë¡œì§**: í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ë“±ê¸‰ì„ DBì—ì„œ ê°€ì ¸ì™€ ê°€ê²© ê³„ì‚°ì— ìë™ ë°˜ì˜

```typescript
export async function getTeeTimesByDate(
  date: Date,
  userSegment?: UserSegment,
  userDistanceKm?: number
): Promise<TeeTimeWithPricing[]> {
  // 1. ì„¸ì…˜ ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸°
  const { data: { user: sessionUser } } = await supabase.auth.getUser();

  // 2. DBì—ì„œ ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ì¡°íšŒ
  let actualUser = null;
  let actualUserSegment: UserSegment = 'FUTURE';

  if (sessionUser?.id) {
    const { data: dbUser } = await (supabase as any)
      .from('users')
      .select('*')
      .eq('id', sessionUser.id)
      .single();

    if (dbUser) {
      actualUser = dbUser;
      actualUserSegment = dbUser.segment;  // PRESTIGE ë“±ì´ë¼ë©´ 5% í• ì¸ ì ìš©!
    }
  }

  // 3. í‹°íƒ€ì„ ì¡°íšŒ ë° ê°€ê²© ê³„ì‚°
  const teeTimes = await supabase
    .from('tee_times')
    .select('*')
    .gte('tee_off', startISO)
    .lte('tee_off', endISO);

  return teeTimes.map(teeTime => {
    const ctx: PricingContext = {
      teeTime,
      user: actualUser,  // ì‹¤ì œ DB ì‚¬ìš©ì ì „ë‹¬
      userDistanceKm
    };

    const result = calculatePricing(ctx);  // ê°€ê²© ê³„ì‚°
    return { ...teeTime, ...result };
  });
}
```

**ì¤‘ìš”**: íƒ€ì„ì¡´ ë¡œì§ ë³´ì¡´
```typescript
// UTC midnight ê³„ì‚° (í•œêµ­ ì‹œê°„ -9ì‹œê°„ ë³´ì •)
const year = date.getFullYear();
const month = date.getMonth();
const day = date.getDate();

const utcMidnight = Date.UTC(year, month, day, 0, 0, 0, 0);
const utcDayEnd = utcMidnight + (24 * 60 * 60 * 1000) - 1;

const startISO = new Date(utcMidnight).toISOString();
const endISO = new Date(utcDayEnd).toISOString();
```

---

## 4. ì¸ì¦ ì‹œìŠ¤í…œ

### 4.1 ì¸ì¦ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì íšŒì›ê°€ì…                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    /login (íšŒì›ê°€ì… íƒ­) â†’ signup() Server Action
                            â†“
    supabase.auth.signUp({
      email: 'user@example.com',
      password: '123456',
      options: {
        data: {
          name: 'í™ê¸¸ë™',      â† ì¤‘ìš”! DB íŠ¸ë¦¬ê±°ê°€ ì½ìŒ
          phone: '010-1234-5678'
        }
      }
    })
                            â†“
    auth.users í…Œì´ë¸”ì— ì‚¬ìš©ì ìƒì„±
                            â†“
    handle_new_user() íŠ¸ë¦¬ê±° ì‹¤í–‰
                            â†“
    public.users í…Œì´ë¸”ì— ìë™ ë³µì‚¬
    (segment: 'FUTURE', cherry_score: 0)
                            â†“
    redirect('/login?message=ê°€ì… ì™„ë£Œ')
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì ë¡œê·¸ì¸                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    /login (ë¡œê·¸ì¸ íƒ­) â†’ login() Server Action
                            â†“
    supabase.auth.signInWithPassword({ email, password })
                            â†“
    ì„¸ì…˜ ì¿ í‚¤ ì„¤ì • (httpOnly, secure)
                            â†“
    redirect('/')
                            â†“
    SiteHeaderê°€ auth ìƒíƒœ ê°ì§€
                            â†“
    ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
```

### 4.2 Server Actions (`app/login/actions.ts`)

#### 4.2.1 íšŒì›ê°€ì…

```typescript
'use server';

import { revalidatePath } from 'next/cache';
import { redirect } from 'next/navigation';
import { supabase } from '@/lib/supabase';

export async function signup(formData: FormData) {
  const email = formData.get('email') as string;
  const password = formData.get('password') as string;
  const name = formData.get('name') as string;
  const phone = formData.get('phone') as string;

  // ìœ íš¨ì„± ê²€ì‚¬
  if (!email || !password) {
    return redirect('/login?message=ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
  }

  if (!name) {
    return redirect('/login?message=ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
  }

  if (password.length < 6) {
    return redirect('/login?message=ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤');
  }

  try {
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: {
          name,    // DB íŠ¸ë¦¬ê±°ê°€ ì´ ê°’ì„ ì½ì–´ public.users.nameì— ì €ì¥
          phone: phone || null,
        },
      },
    });

    if (error) {
      console.error('Signup error:', error);
      return redirect(`/login?message=${encodeURIComponent(error.message)}`);
    }

    return redirect('/login?message=íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
  } catch (error) {
    console.error('Unexpected signup error:', error);
    return redirect('/login?message=íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
  }
}
```

#### 4.2.2 ë¡œê·¸ì¸

```typescript
export async function login(formData: FormData) {
  const email = formData.get('email') as string;
  const password = formData.get('password') as string;

  if (!email || !password) {
    return redirect('/login?message=ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
  }

  try {
    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      return redirect(`/login?message=${encodeURIComponent(error.message)}`);
    }

    // ë ˆì´ì•„ì›ƒ ìºì‹œ ì¬ê²€ì¦ (í—¤ë” ìƒíƒœ ì—…ë°ì´íŠ¸)
    revalidatePath('/', 'layout');

    return redirect('/');
  } catch (error) {
    console.error('Unexpected login error:', error);
    return redirect('/login?message=ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
  }
}
```

#### 4.2.3 ë¡œê·¸ì•„ì›ƒ

```typescript
export async function logout() {
  try {
    const { error } = await supabase.auth.signOut();

    if (error) {
      console.error('Logout error:', error);
    }

    revalidatePath('/', 'layout');
    return redirect('/');
  } catch (error) {
    console.error('Unexpected logout error:', error);
    return redirect('/');
  }
}
```

### 4.3 ë¡œê·¸ì¸/íšŒì›ê°€ì… UI (`app/login/page.tsx`)

**í•µì‹¬ íŠ¹ì§•**:
- íƒ­ìœ¼ë¡œ ë¡œê·¸ì¸/íšŒì›ê°€ì… ì „í™˜
- Suspense ê²½ê³„ë¡œ useSearchParams() ë˜í•‘
- URL ë©”ì‹œì§€ í‘œì‹œ (?message=...)
- ì¹´ì¹´ì˜¤ OAuth ë²„íŠ¼ ë³´ì¡´

**ì‹¤ì œ ì½”ë“œ êµ¬ì¡°**:
```typescript
'use client';

function LoginPageContent() {
  const [activeTab, setActiveTab] = useState<'login' | 'signup'>('login');
  const [message, setMessage] = useState('');

  // URLì—ì„œ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
  useEffect(() => {
    const urlMessage = searchParams.get('message');
    if (urlMessage) {
      setMessage(decodeURIComponent(urlMessage));
    }
  }, [searchParams]);

  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-gradient-to-br from-green-50 to-blue-50 p-4">
      <div className="rounded-2xl bg-white shadow-2xl overflow-hidden">
        {/* íƒ­ ë²„íŠ¼ */}
        <div className="flex border-b">
          <button onClick={() => setActiveTab('login')}>ë¡œê·¸ì¸</button>
          <button onClick={() => setActiveTab('signup')}>íšŒì›ê°€ì…</button>
        </div>

        {/* ë©”ì‹œì§€ í‘œì‹œ */}
        {message && (
          <div className="p-4 bg-blue-50 border border-blue-200">
            <AlertCircle size={20} />
            {message}
          </div>
        )}

        {/* ë¡œê·¸ì¸ í¼ */}
        {activeTab === 'login' && (
          <form action={login}>
            <input type="email" name="email" required />
            <input type="password" name="password" required />
            <button type="submit">ë¡œê·¸ì¸</button>
          </form>
        )}

        {/* íšŒì›ê°€ì… í¼ */}
        {activeTab === 'signup' && (
          <form action={signup}>
            <input type="email" name="email" required />
            <input type="password" name="password" required minLength={6} />
            <input type="text" name="name" required />
            <input type="tel" name="phone" />
            <button type="submit">íšŒì›ê°€ì…</button>
          </form>
        )}

        {/* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ */}
        <button onClick={handleKakaoLogin}>ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  );
}

// Suspense ë˜í•‘ (useSearchParams ì‚¬ìš© ì‹œ í•„ìˆ˜)
export default function LoginPage() {
  return (
    <Suspense fallback={<Loader2 className="animate-spin" />}>
      <LoginPageContent />
    </Suspense>
  );
}
```

### 4.4 ì‚¬ì´íŠ¸ í—¤ë” (`components/SiteHeader.tsx`)

**í•µì‹¬ ê¸°ëŠ¥**:
- ì‹¤ì‹œê°„ ì¸ì¦ ìƒíƒœ í‘œì‹œ
- ë¡œê·¸ì¸ ì‹œ: ì‚¬ìš©ì ì´ë¦„ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
- ë¹„ë¡œê·¸ì¸ ì‹œ: ë¡œê·¸ì¸ ë²„íŠ¼
- onAuthStateChange ë¦¬ìŠ¤ë„ˆë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

```typescript
'use client';

export default function SiteHeader() {
  const [user, setUser] = useState<any>(null);
  const [userName, setUserName] = useState<string>('');

  useEffect(() => {
    // ì´ˆê¸° ì„¸ì…˜ í™•ì¸
    async function checkUser() {
      const { data: { user: sessionUser } } = await supabase.auth.getUser();

      if (sessionUser) {
        setUser(sessionUser);

        // DBì—ì„œ ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        const { data: dbUser } = await (supabase as any)
          .from('users')
          .select('name')
          .eq('id', sessionUser.id)
          .single();

        setUserName(dbUser?.name || sessionUser.email.split('@')[0]);
      }
    }

    checkUser();

    // ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        if (session?.user) {
          setUser(session.user);
          // ì´ë¦„ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°...
        } else {
          setUser(null);
          setUserName('');
        }
      }
    );

    return () => subscription.unsubscribe();
  }, []);

  return (
    <header className="bg-white p-4 flex justify-between items-center">
      <h1 onClick={() => router.push('/')}>TUGOL</h1>

      {user ? (
        <>
          <button onClick={() => router.push('/reservations')}>
            <User size={16} />
            {userName}
          </button>
          <button onClick={handleLogout}>
            <LogOut size={20} />
          </button>
        </>
      ) : (
        <button onClick={() => router.push('/login')}>ë¡œê·¸ì¸</button>
      )}
    </header>
  );
}
```

### 4.5 ì¹´ì¹´ì˜¤ OAuth í†µí•©

```typescript
const handleKakaoLogin = async () => {
  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  const { error } = await supabase.auth.signInWithOAuth({
    provider: 'kakao',
    options: {
      redirectTo: `${window.location.origin}/auth/callback`,
    },
  });

  if (error) {
    setMessage('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
  }
};
```

**Supabase ì„¤ì • í•„ìš” ì‚¬í•­**:
1. Supabase Dashboard â†’ Authentication â†’ Providers â†’ Kakao í™œì„±í™”
2. Kakao Developersì—ì„œ REST API í‚¤ ë°œê¸‰
3. Redirect URI ì„¤ì •: `https://[project-ref].supabase.co/auth/v1/callback`

---

## 5. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ

### 5.1 ê´€ë¦¬ì ê¶Œí•œ ì‹œìŠ¤í…œ

#### 5.1.1 ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (`supabase/migrations/20260115_admin_permissions.sql`)

```sql
-- 1. is_admin ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.users
ADD COLUMN IF NOT EXISTS is_admin BOOLEAN DEFAULT FALSE;

-- 2. ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_users_is_admin
ON public.users(is_admin) WHERE is_admin = TRUE;

-- 3. RLS ì •ì±…: ê´€ë¦¬ìëŠ” ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Admins can view all users"
ON public.users FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM public.users
    WHERE id = auth.uid()::text AND is_admin = TRUE
  )
);

-- 4. RLS ì •ì±…: ê´€ë¦¬ìëŠ” ëª¨ë“  ì‚¬ìš©ì ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "Admins can update all users"
ON public.users FOR UPDATE
USING (
  EXISTS (
    SELECT 1 FROM public.users
    WHERE id = auth.uid()::text AND is_admin = TRUE
  )
);

-- 5. í—¬í¼ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION public.is_user_admin()
RETURNS BOOLEAN AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 FROM public.users
    WHERE id = auth.uid()::text AND is_admin = TRUE
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 6. í…ŒìŠ¤íŠ¸ìš©: ì²« ë²ˆì§¸ ì‚¬ìš©ìë¥¼ ê´€ë¦¬ìë¡œ ì„¤ì •
UPDATE public.users
SET is_admin = TRUE
WHERE id = (SELECT id FROM public.users ORDER BY created_at ASC LIMIT 1);
```

#### 5.1.2 ê´€ë¦¬ì ë ˆì´ì•„ì›ƒ (`app/admin/layout.tsx`)

**ì ‘ê·¼ ì œì–´ ë¡œì§**:
```typescript
'use client';

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  const [isChecking, setIsChecking] = useState(true);
  const [isAdmin, setIsAdmin] = useState(false);

  useEffect(() => {
    async function checkAdminStatus() {
      // 1. ì„¸ì…˜ í™•ì¸
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) {
        router.push('/');  // ë¹„ë¡œê·¸ì¸ â†’ ë©”ì¸ìœ¼ë¡œ
        return;
      }

      // 2. DBì—ì„œ is_admin í™•ì¸
      const { data: user, error } = await (supabase as any)
        .from('users')
        .select('is_admin')
        .eq('id', session.user.id)
        .single();

      if (error || !user?.is_admin) {
        router.push('/');  // ê´€ë¦¬ì ì•„ë‹˜ â†’ ë©”ì¸ìœ¼ë¡œ
        return;
      }

      setIsAdmin(true);
      setIsChecking(false);
    }

    checkAdminStatus();
  }, []);

  if (isChecking) {
    return <div>ê¶Œí•œ í™•ì¸ ì¤‘...</div>;
  }

  if (!isAdmin) {
    return null;  // ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¤‘
  }

  return (
    <div className="flex min-h-screen">
      {/* ì‚¬ì´ë“œë°” */}
      <aside className="w-64 bg-gray-900 text-white">
        <nav>
          <Link href="/admin">ëŒ€ì‹œë³´ë“œ</Link>
          <Link href="/admin/users">íšŒì› ê´€ë¦¬</Link>
        </nav>
      </aside>

      {/* ë©”ì¸ ì½˜í…ì¸  */}
      <main className="flex-1 p-8 bg-gray-100">
        {children}
      </main>
    </div>
  );
}
```

### 5.2 íšŒì› ê´€ë¦¬ í˜ì´ì§€ (`app/admin/users/page.tsx`)

#### 5.2.1 ê¸°ëŠ¥ ëª©ë¡

1. **íšŒì› ëª©ë¡ ì¡°íšŒ**
   - ì „ì²´ íšŒì› ì •ë³´ í…Œì´ë¸” í‘œì‹œ
   - ì´ë©”ì¼, ì´ë¦„, ì „í™”ë²ˆí˜¸, ê°€ì…ì¼, ë“±ê¸‰, í†µê³„ ë“±

2. **ê²€ìƒ‰ ë° í•„í„°ë§**
   - ì´ë©”ì¼/ì´ë¦„/ì „í™”ë²ˆí˜¸ë¡œ ê²€ìƒ‰
   - ë“±ê¸‰ë³„ í•„í„° (FUTURE, SMART, CHERRY, PRESTIGE)

3. **ë“±ê¸‰ ê´€ë¦¬**
   - ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ íšŒì› ë“±ê¸‰ ë³€ê²½
   - `segment_override_by: 'ADMIN'` ê¸°ë¡
   - ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸

4. **ì°¨ë‹¨ ê´€ë¦¬**
   - íšŒì› ì°¨ë‹¨/í•´ì œ
   - ì°¨ë‹¨ ì‚¬ìœ  ì…ë ¥
   - `blacklisted_at`, `blacklisted_by` ê¸°ë¡

5. **ê´€ë¦¬ì ê¶Œí•œ ê´€ë¦¬**
   - ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬/ì œê±°
   - í™•ì¸ ëŒ€í™”ìƒì

#### 5.2.2 í•µì‹¬ ì½”ë“œ

**íšŒì› ëª©ë¡ ì¡°íšŒ**:
```typescript
const fetchUsers = async () => {
  try {
    const { data, error } = await (supabase as any)
      .from('users')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;
    setUsers(data || []);
  } catch (error) {
    console.error('Error fetching users:', error);
    alert('íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
};
```

**ë“±ê¸‰ ë³€ê²½**:
```typescript
const updateUserSegment = async (userId: string, newSegment: SegmentType) => {
  setUpdatingUserId(userId);

  try {
    const { error } = await (supabase as any)
      .from('users')
      .update({
        segment: newSegment,
        segment_override_by: 'ADMIN',
        segment_override_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
      })
      .eq('id', userId);

    if (error) throw error;

    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì¦‰ì‹œ ë°˜ì˜)
    setUsers(prev =>
      prev.map(user =>
        user.id === userId
          ? { ...user, segment: newSegment, segment_override_by: 'ADMIN' }
          : user
      )
    );

    alert('íšŒì› ë“±ê¸‰ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch (error) {
    console.error('Error updating segment:', error);
    alert('ë“±ê¸‰ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  } finally {
    setUpdatingUserId(null);
  }
};
```

**ì°¨ë‹¨ ê´€ë¦¬**:
```typescript
const toggleBlacklistStatus = async (userId: string, currentStatus: boolean) => {
  const reason = currentStatus
    ? null
    : prompt('ì°¨ë‹¨ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');

  if (!currentStatus && !reason) return;

  try {
    const { error } = await (supabase as any)
      .from('users')
      .update({
        blacklisted: !currentStatus,
        blacklist_reason: currentStatus ? null : reason,
        blacklisted_at: currentStatus ? null : new Date().toISOString(),
        blacklisted_by: currentStatus ? null : 'ADMIN'
      })
      .eq('id', userId);

    if (error) throw error;

    setUsers(prev =>
      prev.map(user =>
        user.id === userId
          ? {
              ...user,
              blacklisted: !currentStatus,
              blacklist_reason: currentStatus ? null : reason
            }
          : user
      )
    );

    alert(currentStatus ? 'ì°¨ë‹¨ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'íšŒì›ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch (error) {
    console.error('Error toggling blacklist:', error);
    alert('ì°¨ë‹¨ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
};
```

**ê´€ë¦¬ì ê¶Œí•œ í† ê¸€**:
```typescript
const toggleAdminStatus = async (userId: string, currentStatus: boolean) => {
  const confirmMessage = currentStatus
    ? 'ê´€ë¦¬ì ê¶Œí•œì„ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
    : 'ê´€ë¦¬ì ê¶Œí•œì„ ë¶€ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';

  if (!confirm(confirmMessage)) return;

  try {
    const { error } = await (supabase as any)
      .from('users')
      .update({ is_admin: !currentStatus })
      .eq('id', userId);

    if (error) throw error;

    setUsers(prev =>
      prev.map(user =>
        user.id === userId ? { ...user, is_admin: !currentStatus } : user
      )
    );

    alert('ê´€ë¦¬ì ê¶Œí•œì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch (error) {
    console.error('Error toggling admin:', error);
    alert('ê¶Œí•œ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
};
```

#### 5.2.3 UI êµ¬ì¡°

```tsx
<div className="space-y-6">
  {/* í—¤ë” */}
  <div className="flex justify-between">
    <h1>íšŒì› ê´€ë¦¬</h1>
    <button onClick={fetchUsers}>ìƒˆë¡œê³ ì¹¨</button>
  </div>

  {/* ê²€ìƒ‰/í•„í„° */}
  <div className="bg-white rounded-xl shadow-sm p-6">
    <input type="text" placeholder="ì´ë©”ì¼, ì´ë¦„, ì „í™”ë²ˆí˜¸ë¡œ ê²€ìƒ‰..." />
    <select>
      <option value="ALL">ëª¨ë“  ë“±ê¸‰</option>
      <option value="FUTURE">í“¨ì²˜ (ì‹ ê·œ)</option>
      <option value="SMART">ìŠ¤ë§ˆíŠ¸ (ì¼ë°˜)</option>
      <option value="CHERRY">ì²´ë¦¬ (ìš°ìˆ˜)</option>
      <option value="PRESTIGE">í”„ë ˆìŠ¤í‹°ì§€ (VIP)</option>
    </select>
  </div>

  {/* íšŒì› í…Œì´ë¸” */}
  <table className="w-full">
    <thead>
      <tr>
        <th>íšŒì› ì •ë³´</th>
        <th>í˜„ì¬ ë“±ê¸‰</th>
        <th>ë“±ê¸‰ ë³€ê²½</th>
        <th>Cherry Score</th>
        <th>í†µê³„</th>
        <th>ìƒíƒœ</th>
        <th>ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody>
      {filteredUsers.map(user => (
        <tr key={user.id}>
          {/* íšŒì› ì •ë³´ */}
          <td>
            <div>{user.name}</div>
            <div>{user.email}</div>
            <div>{user.phone}</div>
          </td>

          {/* í˜„ì¬ ë“±ê¸‰ */}
          <td>
            <span className={segmentColors[user.segment]}>
              {segmentLabels[user.segment]}
            </span>
          </td>

          {/* ë“±ê¸‰ ë³€ê²½ ë“œë¡­ë‹¤ìš´ */}
          <td>
            <select
              value={user.segment}
              onChange={(e) => updateUserSegment(user.id, e.target.value)}
            >
              <option value="FUTURE">í“¨ì²˜</option>
              <option value="SMART">ìŠ¤ë§ˆíŠ¸</option>
              <option value="CHERRY">ì²´ë¦¬</option>
              <option value="PRESTIGE">í”„ë ˆìŠ¤í‹°ì§€</option>
            </select>
          </td>

          {/* Cherry Score */}
          <td>{user.cherry_score} / 100</td>

          {/* í†µê³„ */}
          <td>
            <div>ì˜ˆì•½: {user.total_bookings}íšŒ</div>
            <div>ì§€ì¶œ: {user.total_spent.toLocaleString()}ì›</div>
            <div>ë…¸ì‡¼: {user.no_show_count}íšŒ</div>
          </td>

          {/* ìƒíƒœ */}
          <td>
            {user.blacklisted ? (
              <span className="text-red-600">ì°¨ë‹¨ë¨</span>
            ) : (
              <span className="text-green-600">ì •ìƒ</span>
            )}
          </td>

          {/* ê´€ë¦¬ ë²„íŠ¼ */}
          <td>
            <button onClick={() => toggleBlacklistStatus(user.id, user.blacklisted)}>
              {user.blacklisted ? 'ì°¨ë‹¨ í•´ì œ' : 'ì°¨ë‹¨'}
            </button>
            <button onClick={() => toggleAdminStatus(user.id, user.is_admin)}>
              {user.is_admin ? 'ê´€ë¦¬ì í•´ì œ' : 'ê´€ë¦¬ì ì„¤ì •'}
            </button>
          </td>
        </tr>
      ))}
    </tbody>
  </table>

  {/* ë“±ê¸‰ë³„ í†µê³„ */}
  <div className="grid grid-cols-4 gap-4">
    {SEGMENT_OPTIONS.map(segment => {
      const count = users.filter(u => u.segment === segment.value).length;
      return (
        <div key={segment.value} className="bg-white rounded-xl p-6">
          <div>{segment.label}</div>
          <div className="text-2xl font-bold">{count}ëª…</div>
        </div>
      );
    })}
  </div>
</div>
```

---

## 6. ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 6.1 TeeTimeList (`components/TeeTimeList.tsx`)

**ì—­í• **: í‹°íƒ€ì„ ì¹´ë“œ ëª©ë¡ í‘œì‹œ + ë‚ ì§œ ì„ íƒ + ì‹œê°„ëŒ€ í•„í„°

**í•µì‹¬ ë¡œì§**:
```typescript
'use client';

export default function TeeTimeList({
  initialTeeTimes,
  initialDate
}: Props) {
  const [mounted, setMounted] = useState(false);  // í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ ë°©ì§€
  const [teeTimes, setTeeTimes] = useState(initialTeeTimes);
  const [selectedDate, setSelectedDate] = useState(initialDate);
  const [selectedPart, setSelectedPart] = useState<'all' | 'part1' | 'part2' | 'part3'>('all');
  const [showPanic, setShowPanic] = useState(false);

  // ì‹œê°„ëŒ€ í•„í„°ë§
  const filteredTeeTimes = useMemo(() => {
    if (selectedPart === 'all') return teeTimes;

    return teeTimes.filter(tt => {
      const hour = new Date(tt.tee_off).getHours();
      const totalMinutes = hour * 60 + new Date(tt.tee_off).getMinutes();

      if (selectedPart === 'part1') return totalMinutes < 660;   // 05:00-11:00
      if (selectedPart === 'part2') return totalMinutes >= 660 && totalMinutes < 1020;  // 11:00-17:00
      if (selectedPart === 'part3') return totalMinutes >= 1020;  // 17:00-19:30
      return true;
    });
  }, [teeTimes, selectedPart]);

  // íŒ¨ë‹‰ ëª¨ë“œ ì²´í¬
  useEffect(() => {
    if (!mounted) return;

    const panic = teeTimes.some(tt => tt.discountResult?.panicMode?.active);
    if (panic && Math.random() > 0.8) {
      setShowPanic(true);
      setTimeout(() => setShowPanic(false), 5000);
    }
  }, [teeTimes, mounted]);

  // ë‚ ì§œ ë³€ê²½ â†’ URL ì—…ë°ì´íŠ¸ â†’ ì„œë²„ ì¬í˜ì¹­
  const handleDateChange = (date: Date) => {
    setSelectedDate(date);
    const dateStr = date.toISOString().slice(0, 10);
    router.push(`/?date=${dateStr}`);
  };

  return (
    <div>
      {/* ë‚ ì§œ ì„ íƒê¸° */}
      <DateSelector
        selectedDate={selectedDate}
        onDateChange={handleDateChange}
      />

      {/* ì‹œê°„ëŒ€ í•„í„° */}
      <div className="flex gap-2 p-4">
        <button onClick={() => setSelectedPart('all')}>ì „ì²´</button>
        <button onClick={() => setSelectedPart('part1')}>1ë¶€ (05-11ì‹œ)</button>
        <button onClick={() => setSelectedPart('part2')}>2ë¶€ (11-17ì‹œ)</button>
        <button onClick={() => setSelectedPart('part3')}>3ë¶€ (17-19ì‹œ)</button>
      </div>

      {/* í‹°íƒ€ì„ ì¹´ë“œ ëª©ë¡ */}
      <div className="space-y-4 p-4">
        {filteredTeeTimes.map(teeTime => (
          <PriceCard
            key={teeTime.id}
            teeTime={teeTime}
            onClick={() => handleBooking(teeTime)}
          />
        ))}
      </div>

      {/* íŒ¨ë‹‰ ëª¨ë“œ ì˜¤ë²„ë ˆì´ */}
      {showPanic && (
        <div className="fixed inset-0 bg-black/50 z-40 flex items-center justify-center">
          <div className="bg-gradient-to-br from-red-500 to-orange-500 text-white p-8 rounded-2xl">
            <div className="text-4xl font-black">âš¡ PANIC MODE</div>
            <div className="text-xl">ê³µì‹¤ ì„ë°•! ì§€ê¸ˆ ì˜ˆì•½í•˜ì„¸ìš”</div>
          </div>
        </div>
      )}
    </div>
  );
}
```

### 6.2 PriceCard (`components/PriceCard.tsx`)

**ì—­í• **: ê°œë³„ í‹°íƒ€ì„ ê°€ê²© ì •ë³´ í‘œì‹œ

```typescript
export default function PriceCard({ teeTime, onClick }: Props) {
  const hasDiscount = teeTime.basePrice > teeTime.finalPrice;

  return (
    <div
      onClick={onClick}
      className="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition-shadow"
    >
      {/* ì‹œê°„ */}
      <div className="text-2xl font-bold">
        {format(new Date(teeTime.tee_off), 'HH:mm')}
      </div>

      {/* ê°€ê²© */}
      <div className="mt-4">
        {hasDiscount && (
          <div className="text-gray-400 line-through text-sm">
            {teeTime.basePrice.toLocaleString()}ì›
          </div>
        )}
        <div className="text-3xl font-black text-green-600">
          {teeTime.finalPrice.toLocaleString()}ì›
        </div>
      </div>

      {/* í• ì¸ ì´ìœ  */}
      <div className="mt-4 flex flex-wrap gap-2">
        {teeTime.reasons.map((reason, idx) => (
          <span
            key={idx}
            className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs"
          >
            {reason}
          </span>
        ))}
      </div>

      {/* ë‚ ì”¨ ì •ë³´ */}
      <div className="mt-4 flex items-center gap-4 text-sm text-gray-600">
        <div>ğŸŒ¡ï¸ {teeTime.weather.temperature}Â°C</div>
        <div>â˜” {teeTime.weather.rainProb}%</div>
        <div>ğŸ’¨ {teeTime.weather.windSpeed}m/s</div>
      </div>

      {/* íŒ¨ë‹‰ ëª¨ë“œ í‘œì‹œ */}
      {teeTime.discountResult?.panicMode?.active && (
        <div className="mt-4 bg-red-500 text-white p-3 rounded-lg font-bold text-center">
          âš¡ {teeTime.discountResult.panicMode.reason}
        </div>
      )}
    </div>
  );
}
```

### 6.3 BookingModal (`components/BookingModal.tsx`)

**ì—­í• **: ì˜ˆì•½ í™•ì¸ ë° DB ì €ì¥

```typescript
export default function BookingModal({
  isOpen,
  onClose,
  teeTime,
  userId,
  onSuccess
}: Props) {
  const [loading, setLoading] = useState(false);

  const handleConfirm = async () => {
    setLoading(true);

    try {
      // 1. reservations í…Œì´ë¸”ì— ì‚½ì…
      const { data: reservation, error: reservationError } = await supabase
        .from('reservations')
        .insert({
          tee_time_id: teeTime.id,
          user_id: userId,
          base_price: teeTime.basePrice,
          final_price: teeTime.finalPrice,
          discount_breakdown: teeTime.discountResult,
          payment_status: 'PENDING'
        })
        .select()
        .single();

      if (reservationError) throw reservationError;

      // 2. tee_times í…Œì´ë¸” ìƒíƒœ ì—…ë°ì´íŠ¸
      const { error: updateError } = await supabase
        .from('tee_times')
        .update({
          status: 'BOOKED',
          reserved_by: userId,
          reserved_at: new Date().toISOString()
        })
        .eq('id', teeTime.id);

      if (updateError) throw updateError;

      alert('ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      onSuccess?.();
      onClose();
    } catch (error) {
      console.error('Booking error:', error);
      alert('ì˜ˆì•½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
      <div className="bg-white rounded-2xl p-8 max-w-md w-full">
        <h2 className="text-2xl font-bold mb-4">ì˜ˆì•½ í™•ì¸</h2>

        {/* í‹°íƒ€ì„ ì •ë³´ */}
        <div className="space-y-2 mb-6">
          <div>ì‹œê°„: {format(new Date(teeTime.tee_off), 'yyyy-MM-dd HH:mm')}</div>
          <div>ì •ê°€: {teeTime.basePrice.toLocaleString()}ì›</div>
          <div>í• ì¸ê°€: {teeTime.finalPrice.toLocaleString()}ì›</div>
          <div>ì ˆì•½: {(teeTime.basePrice - teeTime.finalPrice).toLocaleString()}ì›</div>
        </div>

        {/* í• ì¸ ë‚´ì—­ */}
        <div className="bg-gray-50 p-4 rounded-lg mb-6">
          <h3 className="font-bold mb-2">í• ì¸ ë‚´ì—­</h3>
          {teeTime.reasons.map((reason, idx) => (
            <div key={idx} className="text-sm text-gray-700">â€¢ {reason}</div>
          ))}
        </div>

        {/* ë²„íŠ¼ */}
        <div className="flex gap-4">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-3 bg-gray-200 rounded-lg hover:bg-gray-300"
          >
            ì·¨ì†Œ
          </button>
          <button
            onClick={handleConfirm}
            disabled={loading}
            className="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50"
          >
            {loading ? 'ì˜ˆì•½ ì¤‘...' : 'ì˜ˆì•½ í™•ì •'}
          </button>
        </div>
      </div>
    </div>
  );
}
```

---

## 7. ê°œë°œ ë‹¨ê³„ë³„ íˆìŠ¤í† ë¦¬

### Phase 1: í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° ê°€ê²© ì±…ì • ì—”ì§„ (v0.1-0.3)
- Next.js 16 í”„ë¡œì íŠ¸ ìƒì„±
- TypeScript, Tailwind CSS ì„¤ì •
- `pricingEngine.ts` êµ¬í˜„
- Seeded Random ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
- ë‚ ì”¨/ì‹œê°„/ë“±ê¸‰ í• ì¸ ë¡œì§ êµ¬í˜„

### Phase 2: Supabase ì—°ë™ (v0.4-0.5)
- Supabase í”„ë¡œì íŠ¸ ìƒì„±
- `tee_times`, `reservations`, `users` í…Œì´ë¸” ìƒì„±
- RLS ì •ì±… ì„¤ì •
- ì´ˆê¸° ë°ì´í„° ì‹œë”©
- Fallback ì‹œìŠ¤í…œ (DB ì‹¤íŒ¨ ì‹œ Mock Data)

### Phase 3: ì˜ˆì•½ í”Œë¡œìš° êµ¬í˜„ (v0.6-0.7)
- `TeeTimeList` ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- `PriceCard` ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- `BookingModal` êµ¬í˜„
- DB Insert/Update ë¡œì§ êµ¬í˜„
- `discount_breakdown` ì»¬ëŸ¼ ì¶”ê°€

### Phase 4: ì˜ˆì•½ ë‚´ì—­ í˜ì´ì§€ (v0.7.1-0.8)
- `/app/reservations/page.tsx` êµ¬í˜„
- JOIN ì¿¼ë¦¬ë¡œ ì˜ˆì•½ ë‚´ì—­ ì¡°íšŒ
- ì˜ˆì•½ ìƒíƒœë³„ í•„í„°ë§
- ì·¨ì†Œ/í™˜ë¶ˆ ê¸°ëŠ¥ ìŠ¤í…

### Phase 5: ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (v0.8.1-0.8.5)
- `is_admin` ì»¬ëŸ¼ ì¶”ê°€
- RLS ì •ì±… ì—…ë°ì´íŠ¸
- `/app/admin/layout.tsx` êµ¬í˜„
- `/app/admin/users/page.tsx` êµ¬í˜„
- íšŒì› ë“±ê¸‰ ê´€ë¦¬ ê¸°ëŠ¥
- ì°¨ë‹¨ ê´€ë¦¬ ê¸°ëŠ¥

### Phase 6: ì¸ì¦ ì‹œìŠ¤í…œ (v0.9)
- `app/login/actions.ts` (signup, login, logout)
- `app/login/page.tsx` (íƒ­í˜• UI)
- `components/SiteHeader.tsx` (ì‹¤ì‹œê°„ auth ìƒíƒœ)
- DB íŠ¸ë¦¬ê±°ë¡œ auth.users â†’ public.users ìë™ ìƒì„±
- ì¹´ì¹´ì˜¤ OAuth í†µí•© ìœ ì§€
- ê°€ê²© ì—”ì§„ê³¼ ì‹¤ì œ ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸ ì—°ë™

### í˜„ì¬ ìƒíƒœ (v0.9)
- âœ… ê°€ê²© ì±…ì • ì—”ì§„ ì™„ë£Œ
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì™„ë£Œ
- âœ… ì˜ˆì•½ í”Œë¡œìš° ì™„ë£Œ
- âœ… ì¸ì¦ ì‹œìŠ¤í…œ ì™„ë£Œ
- âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì™„ë£Œ
- â³ ê²°ì œ ì‹œìŠ¤í…œ (Toss Payments) - ë¯¸êµ¬í˜„
- â³ ë¦¬ë·° ì‹œìŠ¤í…œ - ë¯¸êµ¬í˜„
- â³ í‘¸ì‹œ ì•Œë¦¼ - ë¯¸êµ¬í˜„

---

## 8. ì½”ë“œ ì»¨ë²¤ì…˜ ë° íŒ¨í„´

### 8.1 TypeScript ì‚¬ìš© ê·œì¹™

1. **Strict Mode í™œì„±í™”**
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

2. **Database íƒ€ì…ì€ `types/database.ts`ì—ì„œ import**
```typescript
import { Database } from '@/types/database';

type User = Database['public']['Tables']['users']['Row'];
type TeeTime = Database['public']['Tables']['tee_times']['Row'];
```

3. **Supabase íƒ€ì… ìºìŠ¤íŒ…**
```typescript
// Supabaseì˜ ì—„ê²©í•œ íƒ€ì… ì¶”ë¡ ì´ ì‹¤íŒ¨í•  ë•Œë§Œ ì‚¬ìš©
const { data } = await (supabase as any)
  .from('users')
  .select('*')
  .eq('id', userId);
```

### 8.2 Next.js App Router íŒ¨í„´

1. **Server Component vs Client Component**
```typescript
// Server Component (ê¸°ë³¸)
export default async function Page() {
  const data = await fetchData();  // ì„œë²„ì—ì„œ ì‹¤í–‰
  return <div>{data}</div>;
}

// Client Component (ìƒíƒœ/ì´ë²¤íŠ¸ í•„ìš” ì‹œ)
'use client';
export default function Component() {
  const [state, setState] = useState();
  return <button onClick={() => setState()}>Click</button>;
}
```

2. **Server Actions**
```typescript
// app/actions.ts
'use server';

export async function createReservation(formData: FormData) {
  const data = await supabase.from('reservations').insert(...);
  revalidatePath('/reservations');
  redirect('/reservations');
}
```

3. **Suspense ê²½ê³„**
```typescript
// useSearchParams() ì‚¬ìš© ì‹œ í•„ìˆ˜
export default function Page() {
  return (
    <Suspense fallback={<Loading />}>
      <Content />
    </Suspense>
  );
}
```

### 8.3 ìŠ¤íƒ€ì¼ë§ ì»¨ë²¤ì…˜

1. **Tailwind CSS ìœ í‹¸ë¦¬í‹° ìš°ì„ **
```tsx
<div className="flex items-center justify-between p-4 bg-white rounded-lg shadow-md">
  <h2 className="text-2xl font-bold text-gray-900">Title</h2>
  <button className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
    Action
  </button>
</div>
```

2. **ì¡°ê±´ë¶€ í´ë˜ìŠ¤ëŠ” í…œí”Œë¦¿ ë¦¬í„°ëŸ´**
```tsx
<div className={`
  px-4 py-2 rounded-lg
  ${isActive ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}
  ${disabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'}
`}>
  Button
</div>
```

### 8.4 ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´

1. **Try-Catch + User Feedback**
```typescript
async function fetchData() {
  try {
    const { data, error } = await supabase.from('table').select();
    if (error) throw error;
    return data;
  } catch (error) {
    console.error('Error:', error);
    alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    return [];  // Fallback
  }
}
```

2. **Graceful Degradation**
```typescript
// DB ì‹¤íŒ¨ ì‹œ Mock Dataë¡œ ì „í™˜
let teeTimes = [];
try {
  teeTimes = await fetchFromSupabase();
} catch (error) {
  console.error('DB error, using mock data:', error);
  teeTimes = MOCK_TEE_TIMES;
}
```

### 8.5 State ê´€ë¦¬ íŒ¨í„´

1. **ë¡œì»¬ ìƒíƒœ ìš°ì„  (useState)**
```typescript
const [users, setUsers] = useState<User[]>([]);
const [loading, setLoading] = useState(true);
const [searchTerm, setSearchTerm] = useState('');
```

2. **íŒŒìƒ ìƒíƒœëŠ” useMemo**
```typescript
const filteredUsers = useMemo(() => {
  return users.filter(u =>
    u.email.includes(searchTerm) ||
    u.name?.includes(searchTerm)
  );
}, [users, searchTerm]);
```

3. **ì„œë²„ ìƒíƒœëŠ” Next.js ìºì‹œ í™œìš©**
```typescript
// Server Componentì—ì„œ fetch â†’ ìë™ ìºì‹œ
export const dynamic = 'force-dynamic';  // ìºì‹œ ë¹„í™œì„±í™” ì‹œ
```

### 8.6 íŒŒì¼ êµ¬ì¡°

```
tugol-app-main/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                  # ë©”ì¸ í˜ì´ì§€ (Server Component)
â”‚   â”œâ”€â”€ layout.tsx                # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ë¡œê·¸ì¸/íšŒì›ê°€ì… (Client Component)
â”‚   â”‚   â””â”€â”€ actions.ts            # ì¸ì¦ Server Actions
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # ê´€ë¦¬ì ë ˆì´ì•„ì›ƒ (Client Component)
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚       â””â”€â”€ page.tsx          # íšŒì› ê´€ë¦¬ (Client Component)
â”‚   â””â”€â”€ reservations/
â”‚       â””â”€â”€ page.tsx              # ì˜ˆì•½ ë‚´ì—­
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TeeTimeList.tsx           # í‹°íƒ€ì„ ëª©ë¡ (Client Component)
â”‚   â”œâ”€â”€ PriceCard.tsx             # ê°€ê²© ì¹´ë“œ
â”‚   â”œâ”€â”€ BookingModal.tsx          # ì˜ˆì•½ ëª¨ë‹¬
â”‚   â”œâ”€â”€ DateSelector.tsx          # ë‚ ì§œ ì„ íƒê¸°
â”‚   â””â”€â”€ SiteHeader.tsx            # ì‚¬ì´íŠ¸ í—¤ë” (Client Component)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ pricingEngine.ts          # ê°€ê²© ê³„ì‚° ë¡œì§
â”‚   â””â”€â”€ supabase/
â”‚       â””â”€â”€ queries.ts            # DB ì¿¼ë¦¬ í•¨ìˆ˜
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ supabase.ts               # Supabase í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ types/
â”‚   â””â”€â”€ database.ts               # DB íƒ€ì… ì •ì˜
â””â”€â”€ supabase/
    â””â”€â”€ migrations/
        â”œâ”€â”€ 20260115_enhanced_users.sql
        â””â”€â”€ 20260115_admin_permissions.sql
```

---

## 9. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env.local

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxxxxxx...

# ë‚ ì”¨ API
WEATHER_API_KEY=your-api-key-here
GRID_X=54
GRID_Y=123

# (í–¥í›„ ê²°ì œ ì‹œìŠ¤í…œ ì¶”ê°€ ì‹œ)
# NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_...
# TOSS_SECRET_KEY=test_sk_...
```

---

## 10. ì£¼ìš” ëª…ë ¹ì–´

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev

# í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build

# íƒ€ì… ì²´í¬
npm run type-check

# ë¦°íŠ¸
npm run lint

# Supabase ë¡œì»¬ ê°œë°œ (optional)
supabase start
supabase db reset
supabase migration new <migration-name>
```

---

## 11. í–¥í›„ ê°œë°œ ë¡œë“œë§µ

### ë‹¨ê¸° (1-2ì£¼)
- [ ] Toss Payments ê²°ì œ ì—°ë™
- [ ] ì˜ˆì•½ ì·¨ì†Œ/í™˜ë¶ˆ ê¸°ëŠ¥
- [ ] ì´ë©”ì¼ ì•Œë¦¼ (ì˜ˆì•½ í™•ì¸, ì·¨ì†Œ)

### ì¤‘ê¸° (1ê°œì›”)
- [ ] ë¦¬ë·° ì‹œìŠ¤í…œ
- [ ] Cherry Score ìë™ ê³„ì‚° ë¡œì§
- [ ] ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤ (LBS) ì‹¤ì œ êµ¬í˜„
- [ ] í‘¸ì‹œ ì•Œë¦¼ (FCM)

### ì¥ê¸° (3ê°œì›”)
- [ ] ëª¨ë°”ì¼ ì•± (React Native)
- [ ] ë‹¤ì¤‘ ê³¨í”„ì¥ ì§€ì›
- [ ] AI ì¶”ì²œ ì‹œìŠ¤í…œ
- [ ] ë¡œì—´í‹° í”„ë¡œê·¸ë¨

---

**ë¬¸ì„œ ì¢…ë£Œ**

ì´ ë¬¸ì„œëŠ” TUGOL í”„ë¡œì íŠ¸ì˜ í˜„ì¬ ìƒíƒœ(v0.9)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
AI ì»¨í…ìŠ¤íŠ¸ í•™ìŠµ ë° í”„ë¡œì íŠ¸ ì§€ì†ì„±ì„ ìœ„í•´ ì‹¤ì œ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°,
ì¶”ë¡ ì´ë‚˜ ê°€ì • ì—†ì´ ì‹¤ì œ êµ¬í˜„ëœ ë‚´ìš©ë§Œì„ ê¸°ë¡í•˜ì˜€ìŠµë‹ˆë‹¤.

**ìµœì¢… ì—…ë°ì´íŠ¸:** 2026-01-16
**ì‘ì„±ì:** Claude (AI Assistant)
**ë¬¸ì„œ ë²„ì „:** 1.0
