# TUGOL â€” Phase 10 Runtime Knowledge Snapshot (v1.0)

**Project:** TUGOL (Dynamic Pricing Golf Booking Platform)  
**Version:** v1.0 (MVP + Payment + Deploy Complete)  
**Phase ê¸°ì¤€:** Phase 10 (MVP ê°œë°œ ì™„ë£Œ & Vercel ë°°í¬ ì„±ê³µ ì‹œì )  
**Environment:** Production (Vercel + Supabase)

---

## [0] System Role & Usage

ë„ˆëŠ” ì§€ê¸ˆë¶€í„° ê³¨í”„ í‹°íƒ€ì„ ì˜ˆì•½ í”Œë«í¼ **TUGOL**ì˜  
**ë©”ì¸ ì•„í‚¤í…íŠ¸ + PM + ê¸°ìˆ  ë¬¸ì„œ ê´€ë¦¬ì + RAG ì»¨í…ìŠ¤íŠ¸ ìŠ¤í† ë¦¬ì§€**ë‹¤.

ì´ ë¬¸ì„œëŠ”:

- ìƒˆ LLM ì„¸ì…˜ì—ì„œ í”„ë¡œì íŠ¸ ìƒí™©ì„ ë¹ ë¥´ê²Œ ë³µì›
- ê¸°íš 10ì¢… ë³´ê³ ì„œ + ì‹¤ì œ ì½”ë“œ + ë°°í¬ ìƒíƒœ ì—°ê²°
- "ì´ì „ ìƒí™© ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ ê°œë°œ"ì„ ìœ„í•œ ê·¼ê±° ì œê³µ

---

## [1] í”„ë¡œì íŠ¸ ìŠ¤ëƒ…ìƒ· (Phase 10 ê¸°ì¤€)

**í”„ë¡œì íŠ¸ëª…:** TUGOL  
**í•µì‹¬ ê°€ì¹˜:** Dynamic Pricing ê¸°ë°˜ ê³¨í”„ ì˜ˆì•½ + Panic Mode  
**í˜„ì¬ ìƒíƒœ:**

- Phase 1~7: ì„¤ê³„/DB/UX/ê¸°íš ê¸°ë°˜ í™•ë¦½  
- Phase 8: Toss ê²°ì œ + DB + ì˜ˆì•½ ë°˜ì˜ê¹Œì§€ ê²€ì¦ ì™„ë£Œ  
- Phase 9: Date Picker & Time Slice UI ì™„ì„±  
- Phase 10: Vercel ë°°í¬ ì™„ë£Œ + MVP ì‘ë™ í™•ì¸  

---

## [2] Tech Stack & Deployment

### ìŠ¤íƒ

- **Frontend:** Next.js 15/16(App Router), TS, Tailwind
- **Backend:** Next.js API Routes
- **DB:** Supabase(PostgreSQL)
- **Payment:** Toss Payments â€” Payment Widget
- **Deploy:** Vercel

### Deployment ì´ìŠˆ í•´ê²°

ë¬¸ì œ â†’ GitHub Root mismatchë¡œ ë¹Œë“œ/ë¼ìš°íŒ… ì‹¤íŒ¨  
í•´ê²° â†’ Vercel Root Directory ì´ˆê¸°í™”ë¡œ ìµœìƒìœ„ `package.json` ì¸ì‹

---

## [3] ë””ë ‰í† ë¦¬ êµ¬ì¡° (ìš”ì•½)

```
app/
  page.tsx
  layout.tsx
  api/payments/confirm
  payment/success
  payment/fail
  admin/
components/
  BookingModal.tsx
  DateSelector.tsx
utils/
  supabase/queries.ts
types/
  database.ts
lib/
  supabase.ts
```

---

## [4] êµ¬í˜„ëœ ê¸°ëŠ¥ (MVP ê¸°ì¤€)

### (1) ë‚ ì§œ ì„ íƒ (14ì¼)

- Today ê°•ì¡°
- Horizontal Chip UI
- onDateChange â†’ Supabase ì¬ì¡°íšŒ

### (2) 3ë¶€ì œ íƒ€ì„ í•„í„°

| êµ¬ë¶„ | ì‹œê°„ | ì•„ì´ì½˜ |
|---|---|---|
| 1ë¶€ | 05~10:59 | ğŸŒ… |
| 2ë¶€ | 11~16:59 | ğŸŒ |
| 3ë¶€ | 17~     | ğŸŒ™ |

`useMemo`ë¡œ tee_times í•„í„°ë§

### (3) Dynamic Pricing UI

ë…¸ì¶œ êµ¬ì¡°:

```
~~ì •ê°€~~ (ì‘ê³  íšŒìƒ‰)
í• ì¸ê°€(í¬ê²Œ ê°•ì¡°)
reasons[]
```

### (4) Panic Deal(Pseudo)

ëœë¤ íŒì—…  
LBS/ì„ë°• ëª¨ë“œëŠ” í–¥í›„ í™•ì¥

### (5) ì˜ˆì•½ & Toss ê²°ì œ í”Œë¡œìš°

`BookingModal.tsx`:

- Toss Payment Widget
- Strict ëª¨ë“œ double-init â†’ `useRef` Singleton í•´ê²°

`/payment/success`:

- `useSearchParams()` â†’ CSR í•„ìš” â†’ `<Suspense>` ì‚¬ìš©

`/api/payments/confirm`:

- Toss Server ìŠ¹ì¸
- ê²€ì¦ ì„±ê³µ ì‹œ:
  - `reservations` INSERT
  - `tee_times.status = 'BOOKED'`
- ì‹¤íŒ¨ ì‹œ rollback

---

## [5] Supabase Schema (ìµœì¢…)

### í…Œì´ë¸”: `tee_times`

| Column | Type | ì„¤ëª… |
|---|---|---|
| id | int8 | PK |
| tee_off | timestamptz | UTC |
| base_price | int4 | ì •ê°€ |
| price | int4 | ìµœì¢…ê°€ |
| status | `'OPEN' \| 'BOOKED' \| 'BLOCKED'` | ENUM |
| currency | text | KRW |
| reserved_at | timestamptz | ì˜ˆì•½ ì‹œê° |
| reserved_by | int8 | FK(user) |

### í…Œì´ë¸”: `reservations`

| Column | Type | ì„¤ëª… |
|---|---|---|
| id | int8 | PK |
| tee_time_id | int8 | FK |
| user_id | int8 | FK |
| status | text | `'CONFIRMED' \| 'CANCELLED'` |
| amount | int4 | ê²°ì œ ê¸ˆì•¡ |
| payment_key | text | Toss PaymentKey |
| receipt_url | text | Toss ì „í‘œ |
| payment_status | text | `'PAID' \| 'FAILED'` |

ê°œë°œ ë‹¨ê³„ â†’ RLS ë¹„í™œì„±í™”  
PROD ì „í™˜ â†’ Policy í•„ìš”

---

## [6] Troubleshooting (Phase 8~10)

### Strict Mode + Widget

- Dev double-init ë¬¸ì œ
- `useRef` Singleton íŒ¨í„´ìœ¼ë¡œ í•´ê²°

### ENUM ëŒ€ì†Œë¬¸ì

- `'open' vs 'OPEN'` mismatch â†’ DB ìŠ¤í‚¤ë§ˆ ê¸°ì¤€ìœ¼ë¡œ í†µì¼

### RLS

- ê°œë°œ ë‹¨ê³„ DISABLE â†’ PRODì—ì„œ ì„¤ê³„ ì˜ˆì •

### Schema ë³€ê²½ ìºì‹œ

- Supabase ìŠ¤í‚¤ë§ˆ ìˆ˜ì • í›„ Dev ì„œë²„ ì¬ì‹œì‘ í•„ìš”

### Suspense + SearchParams

- CSR ë³´ì¥ ìœ„í•´ `<Suspense>` ì‚¬ìš©

---

## [7] Phase History ìš”ì•½

- Phase 8 â†’ Toss ê²°ì œ + DB ë°˜ì˜ + ì˜ˆì•½ í™•ì •
- Phase 9 â†’ DateSelector + 3ë¶€ì œ í•„í„°
- Phase 10 â†’ Vercel ë°°í¬ + MVP ì™„ì„±

---

## [8] Post-MVP í™•ì¥ ì§€ì 

- ê¸°ìƒì²­ POP/RN1 ê¸°ë°˜ Pricing
- LBS ê¸°ë°˜ Panic
- CRM(Future/Prestige/Cherry)
- Admin Override + í‹°íƒ€ì„ ê´€ë¦¬
- Prod ë ˆë²¨ RLS
- Yield/Conversion ë¶„ì„

---

## [9] RAG Retrieval Guide

ìœ ìš©í•œ ì§ˆë¬¸ ì˜ˆì‹œ:

- "ê²°ì œ í”Œë¡œìš° ë‹¨ê³„ë³„ ì„¤ëª…"
- "í˜„ì¬ Adminì˜ ë¯¸êµ¬í˜„ ê¸°ëŠ¥ ì •ë¦¬"
- "Dynamic Pricing ì¤‘ êµ¬í˜„ëœ ë¶€ë¶„ vs ê¸°íšëœ ë¶€ë¶„"
- "Supabase íƒ€ì… ê¸°ë°˜ TS ì¸í„°í˜ì´ìŠ¤ ì¬ìƒì„±"
- "Post-MVP ìš°ì„ ìˆœìœ„ ì œì•ˆ"

---

# END OF FILE
